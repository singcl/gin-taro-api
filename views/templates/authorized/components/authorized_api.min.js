import{h,reactive,toRef,watch,ref}from"/views/static/js/vue/vue3.esm-browser.js";import naive from"/views/static/js/vue/naive.js";import Kiko from"/views/static/js/utils/kiko/Kiko.js";import{getTagType}from"./utils.js";import ApiAddDialog from"./authorized_api_add.js";const{NDrawer,NList,NListItem,useMessage,useDialog,NAlert,NThing,NTag,NEmpty,NButton}=naive;export default{props:{visible:Boolean,detailData:Object},emits:["update:visible","kiko:conform"],setup(e){const i=useMessage(),s=useDialog(),t=toRef(e,"visible"),a=toRef(e,"detailData"),o=ref(!1),n=reactive({business_key:void 0,list:[]});async function l(){var{business_key:e,list:t=[]}=await(new Kiko).fetch("/api/authorized_api",{method:"GET",body:{id:a.value.hashid}});n.business_key=e,n.list=t}function r(){o.value=!0}function u(e){o.value=Boolean(e)}function c(e){console.log(e),l()}return watch(t,async function(e){e&&l()}),()=>h(NDrawer,{show:t.value,style:{width:"900px"}},()=>[h(NAlert,{type:"info",title:"API授权详情"},()=>"接口地址支持通配符(*)，其中 * 表示 1 级，** 表示 n 级。"),h(NList,{style:{margin:"0 15px"}},{header:()=>h("h3",{style:{margin:0,display:"flex",alignItems:"center",justifyContent:"space-between"}},[h("span",null,"授权方："+n.business_key),h(NButton,{type:"success",onClick:r},()=>"新增API授权")]),default:()=>n.list&&0<n.list.length?n.list.map(t=>h(NListItem,null,{default:()=>h(NThing,null,{header:()=>h(NTag,{type:getTagType(t.method),round:!0},()=>t.method),description:()=>t.api,"header-extra":()=>{return h(NButton,{type:"error",onClick:(e=t,async function(){s.warning({title:"警告",content:"确定取消当前API授权吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await(new Kiko).fetch("/api/authorized_api/"+e.hash_id,{method:"DELETE"}),i.success("成功取消授权"),l()}catch(e){i.error(`取消授权失败:code: ${e.code};message: `+e.message)}}})})},()=>"取消授权");var e}})})):h(NEmpty,{description:"没有任何已授权接口"})}),h(ApiAddDialog,{visible:o.value,"onUpdate:visible":u,onClose:u,"onKiko:conform":c,detailData:a})])}};