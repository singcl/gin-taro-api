import{h,reactive,ref,onMounted}from"/views/static/js/vue/vue3.esm-browser.js";import naive from"/views/static/js/vue/naive.js";import Kiko from"/views/static/js/utils/kiko/Kiko.js";import AddDialog from"./components/authorized_add.js";import AuthApiDrawer from"./components/authorized_api.js";const{useMessage,useDialog}=naive,useOptions=[{value:1,label:"启用",type:"success"},{value:-1,label:"禁用",type:"warning"}],defaultColumnsConfig=[{key:"id",title:"编号"},{key:"hashid",title:"hashid"},{key:"business_key",title:"调用方"},{key:"business_secret",title:"调用方Secret"},{key:"business_developer",title:"对接人"},{key:"created_at",title:"创建日期",render(e){e=e.created_at;return e.split(/\s/)[0]}},{key:"updated_at",title:"更新日期",render(e){e=e.created_at;return e.split(/\s/)[0]}},{key:"remark",title:"备注"},{key:"is_used",title:"状态",render(e){const t=e["is_used"],i=useOptions.find(e=>e.value==t);return i?h(naive.NTag,{type:i.type},()=>i.label):t}},{key:"operation",title:"操作",align:"right"}];export default{setup(){var e=defaultColumnsConfig.map(e=>{let t=e;return t="operation"===e.key?{...t,render(e){var t=e["is_used"];const i={1:-1,"-1":1}[t],a=useOptions.find(e=>e.value==i);return h("div",[h(naive.NButton,{type:"info",style:{marginRight:"10px"},onClick:()=>async function(e){s.value=!0,n.value=e}(e)},()=>"接口"),a?h(naive.NButton,{type:a.type,style:{marginRight:"10px"},onClick:()=>async function(e){const{hashid:t,is_used:i}=e,a={1:-1,"-1":1}[i],s=useOptions.find(e=>e.value==a);r.warning({title:"警告",content:`确定${s.label}当前授权吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await(new Kiko).fetch("/api/authorized/used",{method:"PATCH",body:{id:t,used:a}}),o.success(s.label+"成功！"),l()}catch(e){o.error(`code: ${e.code};message: `+e.message)}}})}(e)},()=>a.label):void 0,h(naive.NButton,{type:"error",onClick:()=>async function(e){const t=e["hashid"];r.warning({title:"警告",content:"确定删除当前授权吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await(new Kiko).fetch("/api/authorized/"+t,{method:"DELETE"}),o.success("删除成功！"),l()}catch(e){o.error(`code: ${e.code};message: `+e.message)}}})}(e)},()=>"删除")])}}:t});const t=reactive(e),i=ref([]),a=ref(!1),s=ref(!1),n=ref(null),o=useMessage(),r=useDialog();async function l(){try{var e=await(new Kiko).fetch("/api/authorized");i.value=e.list}catch(e){o.error(`code: ${e.code};message: `+e.message)}}function u(){a.value=!0}function c(e){a.value=Boolean(e)}function d(e){s.value=Boolean(e)}function v(e){console.log(e),l()}return onMounted(async()=>{await l()}),()=>h("div",{style:{maxWidth:"1200px",margin:"0 auto"}},[h(naive.NAlert,{type:"success",title:"授权信息",style:"margin-bottom: 10px"},()=>"已授权信息表格"),h("div",[h("div",{style:{marginBottom:"10px",textAlign:"right",padding:"0 12px"}},[h(naive.NButton,{type:"info",onClick:u},()=>"新增")]),h(naive.NDataTable,{columns:t,bordered:!1,data:i.value})]),h(naive.NMessageProvider,()=>h(AddDialog,{visible:a.value,"onUpdate:visible":c,onClose:c,"onKiko:conform":v})),h(naive.NMessageProvider,()=>h(AuthApiDrawer,{detailData:n,visible:s.value,"onUpdate:visible":d,"onUpdate:show":d}))])}};