import{h,reactive,ref,onMounted}from"/views/static/js/vue/vue3.esm-browser.js";import naive from"/views/static/js/vue/naive.js";import Kiko from"/views/static/js/utils/kiko/Kiko.js";import AddDialog from"./components/admin_add.js";const{useMessage,useDialog}=naive,useOptions=[{value:1,label:"启用",type:"success"},{value:-1,label:"禁用",type:"warning"}],onlineOptions=[{value:1,label:"在线",type:"success"},{value:-1,label:"不在线",type:"warning"}],defaultColumnsConfig=[{key:"id",title:"编号"},{key:"hashid",title:"hashid"},{key:"username",title:"用户名"},{key:"mobile",title:"手机号"},{key:"nickname",title:"昵称"},{key:"created_user",title:"创建人"},{key:"created_at",title:"创建日期",render(e){e=e.created_at;return e.split(/\s/)[0]}},{key:"updated_user",title:"更新人"},{key:"updated_at",title:"更新日期",render(e){e=e.created_at;return e.split(/\s/)[0]}},{key:"is_online",title:"在线状态",render(e){const t=e["is_online"],i=onlineOptions.find(e=>e.value==t);return i?h(naive.NBadge,{type:i.type,dot:!0},()=>i.label):t}},{key:"is_used",title:"状态",render(e){const t=e["is_used"],i=useOptions.find(e=>e.value==t);return i?h(naive.NTag,{type:i.type},()=>i.label):t}},{key:"operation",title:"操作",align:"right"}];export default{setup(){var e=defaultColumnsConfig.map(e=>{let t=e;return t="operation"===e.key?{...t,render(e){return h(naive.NDropdown,{options:function(e){const t=e["is_used"],i={1:-1,"-1":1}[t],n=useOptions.find(e=>e.value==i);return[{type:"render",key:"interface",render(){return h(naive.NButton,{type:"info",text:!0,style:{marginRight:"10px",width:"100%",marginBottom:"6px"},onClick:()=>async function(e){a.value=!0,o.value=e}(e)},()=>"接口")}},{type:"render",key:"used",render(){return n?h(naive.NButton,{type:n.type,text:!0,style:{width:"100%",marginBottom:"6px"},onClick:()=>async function(e){const{hashid:t,is_used:i}=e,n={1:-1,"-1":1}[i],a=useOptions.find(e=>e.value==n);r.warning({title:"警告",content:`确定${a.label}当前用户吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await(new Kiko).fetch("/api/admin/used",{method:"PATCH",body:{id:t,used:n}}),s.success(a.label+"成功！"),l()}catch(e){s.error(`code: ${e.code};message: `+e.message)}}})}(e)},()=>n.label):void 0}},{type:"render",key:"delete",render(){return h(naive.NButton,{type:"error",style:{width:"100%",marginBottom:"6px"},text:!0,onClick:()=>async function(e){const t=e["hashid"];r.warning({title:"警告",content:"确定删除当前用户吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await(new Kiko).fetch("/api/admin/"+t,{method:"DELETE"}),s.success("删除成功！"),l()}catch(e){s.error(`code: ${e.code};message: `+e.message)}}})}(e)},()=>"删除")}},{type:"render",key:"offline",render(){return h(naive.NButton,{type:"error",text:!0,style:{width:"100%",marginBottom:"6px"},onClick:()=>async function(e){const t=e["hashid"];r.warning({title:"警告",content:"确定下线当前用户吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await(new Kiko).fetch("/api/admin/offline",{method:"PATCH",body:{id:t}}),s.success("下线成功！"),l()}catch(e){s.error(`code: ${e.code};message: `+e.message)}}})}(e)},()=>"下线")}},{type:"render",key:"reset",render(){return h(naive.NButton,{type:"warning",text:!0,style:{width:"100%",marginBottom:"6px"},onClick:()=>async function(e){const t=e["hashid"];r.warning({title:"警告",content:"确定重置当前用户密码吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{await(new Kiko).fetch("/api/admin/reset_password/"+t,{method:"PATCH"}),s.success("重置成功！"),l()}catch(e){s.error(`code: ${e.code};message: `+e.message)}}})}(e)},()=>"重置密码")}}]}(e),trigger:"click",width:"trigger"},()=>h(naive.NButton,{type:"info",size:"small"},()=>"批量操作"))}}:t});const t=reactive(e),i=ref([]),n=ref(!1),a=ref(!1),o=ref(null),s=useMessage(),r=useDialog();async function l(){try{var e=await(new Kiko).fetch("/api/admin",{method:"get"});i.value=e.list}catch(e){s.error(`code: ${e.code};message: `+e.message)}}function c(){n.value=!0}function d(e){n.value=Boolean(e)}function u(e){console.log(e),l()}return onMounted(async()=>{await l()}),()=>h("div",{style:{maxWidth:"1200px",margin:"0 auto"}},[h(naive.NAlert,{type:"success",title:"管理员信息",style:"margin-bottom: 10px"},()=>"已授权管理员列表"),h("div",[h("div",{style:{marginBottom:"10px",textAlign:"right",padding:"0 12px"}},[h(naive.NButton,{type:"info",onClick:c},()=>"新增")]),h(naive.NDataTable,{columns:t,bordered:!1,data:i.value})]),h(naive.NMessageProvider,()=>h(AddDialog,{visible:n.value,"onUpdate:visible":d,onClose:d,"onKiko:conform":u}))])}};